% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/mcmc_parcel_mcmc_kernels.R
\name{replace_lcc_move}
\alias{replace_lcc_move}
\title{Replace-LCC move with retention + capacity-matched sampling}
\usage{
replace_lcc_move(
  state,
  lcc_library,
  secondary_library,
  parcel_graph,
  constraints,
  cap_tolerance = 4000,
  neighbor_idx = NULL,
  parcel_names = NULL
)
}
\arguments{
\item{state}{Current state}

\item{lcc_library}{LCC candidate library}

\item{secondary_library}{Secondary library}

\item{parcel_graph}{igraph object}

\item{constraints}{MBTA constraints}

\item{cap_tolerance}{Capacity tolerance for similar-LCC sampling (default 4000).
Wide tolerance allows escaping from high-cap to low-cap modes.}

\item{neighbor_idx}{List of integer neighbor indices (for incremental tracking)}

\item{parcel_names}{Character vector of all parcel names (for incremental tracking)}
}
\value{
List with new_state, accepted, move_type, details
}
\description{
Proposes jumping to a new LCC while keeping ALL current secondaries.
The new LCC is sampled from a capacity-similar set to improve acceptance.
}
\details{
This approach solves the k-mismatch problem: birth/death creates states
with k≈5, but resampling proposals generate k≈1-2. By retaining secondaries,
k stays constant and MH acceptance improves dramatically.

Proposal:
\enumerate{
\item Find LCCs with capacity within ±cap_tolerance of current
\item Sample new LCC with capacity-aware weights (prefer smaller LCCs near max_cap)
\item Check all current secondaries are compatible with new LCC
\item Keep all secondaries (no resampling)
}

MH ratio corrects for weighted proposal asymmetry:
log_q_ratio = log(w_old) - log(w_new) + log(Z_forward) - log(Z_reverse)
}
