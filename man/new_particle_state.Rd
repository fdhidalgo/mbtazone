% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/smc_particle.R
\name{new_particle_state}
\alias{new_particle_state}
\title{Create New Particle State}
\usage{
new_particle_state(seed_parcel_id, map, seed_prob = 1)
}
\arguments{
\item{seed_parcel_id}{Integer index of seed parcel (row in map$data)}

\item{map}{An mbta_map object containing parcel data and requirements}

\item{seed_prob}{Probability of selecting this seed parcel (for biased
seed selection strategies). Default: 1.0 (uniform random selection)}
}
\value{
A ParticleState S3 object (list) with components:
\item{parcel_ids}{Integer vector of parcel indices in zone}
\item{n_parcels}{Number of parcels in zone}
\item{component_id}{Connected component ID}
\item{total_capacity}{Total unit capacity in zone}
\item{total_area}{Total area in zone (acres)}
\item{station_capacity}{Capacity within station areas}
\item{station_area}{Area within station areas (acres)}
\item{remaining_capacity}{Capacity left in component}
\item{remaining_area}{Area left in component (acres)}
\item{remaining_station_capacity}{Station capacity left in component}
\item{remaining_station_area}{Station area left in component (acres)}
\item{log_proposal_path}{Cumulative log probability of proposal path Q(Ï„)}
\item{valuation_score}{V(x) for resampling guidance}
\item{active}{Boolean indicating if particle is alive}
\item{n_steps}{Number of propagation steps taken}
}
\description{
Initialize a particle from a seed parcel for SMC simulation. Sets up all
running sums (Tier 1) and infeasibility tracking (Tier 2) based on the
seed parcel's connected component.
}
\details{
\subsection{Initialization Logic}{

The particle is initialized with the seed parcel and all running sums are
set based on:
\enumerate{
\item Seed parcel attributes (capacity, area, station overlap)
\item Connected component totals (for infeasibility tracking)
\item Seed selection probability (for importance sampling)
}
}

\subsection{Running Sums (Tier 1)}{

Two sets of running sums are maintained:
\itemize{
\item \strong{Totals}: Cumulative sums of parcels in zone (increment each step)
\item \strong{Remaining}: What's left in connected component (decrement each step)
}

This enables O(1) infeasibility checks without recomputing reachable sets.
}

\subsection{Component-Based Tracking}{

Particles can only add parcels from their initial connected component
(rook adjacency). The \verb{remaining_*} fields track the maximum capacity/area
achievable by adding all remaining parcels in the component.
}
}
\examples{
\dontrun{
# Create mbta_map
parcels <- load_municipality("inst/extdata/parcels/57_CHELSEA_basic.zip")
chelsea_map <- mbta_map(parcels, community_type = "rapid_transit")

# Initialize particle from random seed in station area
station_parcels <- which(parcels$in_station_area == 1)
seed_id <- sample(station_parcels, 1)
particle <- new_particle_state(seed_id, chelsea_map)

# Examine initial state
print(particle$total_capacity)
print(particle$remaining_capacity)
}

}
\seealso{
\code{\link{add_parcel_to_particle}}, \code{\link{check_infeasibility}}
}
